<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hcis.ipanther.common.login.mapper.LoginUserMapper" >
  <resultMap id="BaseResultMap" type="com.hcis.ipanther.common.login.vo.LoginUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 03 14:49:35 CST 2014.
    -->
    <result column="ID" jdbcType="VARCHAR" property="id" />
    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
    <result column="PASSWORD" jdbcType="VARCHAR" property="password" />
    <result column="ROLE_CODE" jdbcType="VARCHAR" property="roleCode" />
    <result column="PAPERWORK_NO" jdbcType="VARCHAR" property="paperworkNo" />
    <result column="REAL_NAME" jdbcType="VARCHAR" property="realName" />
    <!--<result column="DEPT_ID" jdbcType="VARCHAR" property="deptId" />-->
    <result column="DEPT_NAME" jdbcType="VARCHAR" property="deptName" />
    <result column="DEPT_LEVEL" jdbcType="DECIMAL" property="deptLevel" />
    <result column="DEPT_TYPE" jdbcType="VARCHAR" property="deptType" />
    <result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
    <result column="REGIONS_CODE" jdbcType="VARCHAR" property="regionsCode" />
    <result column="AVATAR" jdbcType="VARCHAR" property="avatar" />
    <result column="PASSWORD_PLAIN" jdbcType="VARCHAR" property="passwordPlain" />
    <result column="STATUS" jdbcType="VARCHAR" property="state" />
    <result column="DATA_POSITION" jdbcType="CHAR" property="dataPosition" />
    
    <result column="TYPE" jdbcType="VARCHAR" property="type" />
  </resultMap>
  <resultMap id="LoginUser" type="com.hcis.ipanther.common.login.vo.LoginUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 03 14:49:35 CST 2014.
    -->
    <result column="ID" jdbcType="VARCHAR" property="id" />
    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
    <result column="PASSWORD" jdbcType="VARCHAR" property="password" />
    <result column="ROLE_CODE" jdbcType="VARCHAR" property="roleCode" />
    <result column="PAPERWORK_NO" jdbcType="VARCHAR" property="paperworkNo" />
    <result column="REAL_NAME" jdbcType="VARCHAR" property="realName" />
    <!--<result column="DEPT_ID" jdbcType="VARCHAR" property="deptId" />-->
    <result column="DEPT_NAME" jdbcType="VARCHAR" property="deptName" />
    <result column="DEPT_LEVEL" jdbcType="DECIMAL" property="deptLevel" />
    <result column="DEPT_TYPE" jdbcType="VARCHAR" property="deptType" />
    <result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
    <result column="REGIONS_CODE" jdbcType="VARCHAR" property="regionsCode" />
    <result column="AVATAR" jdbcType="VARCHAR" property="avatar" />
    <result column="PASSWORD_PLAIN" jdbcType="VARCHAR" property="passwordPlain" />
    <result column="STATUS" jdbcType="VARCHAR" property="state" />
    <result column="DATA_POSITION" jdbcType="CHAR" property="dataPosition" />
    <result column="TYPE" jdbcType="VARCHAR" property="type" />
    <result column="WECHAT_ID" jdbcType="VARCHAR" property="wechatId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 03 14:49:35 CST 2014.
    -->
    ID, USER_NAME, PASSWORD, ROLE_CODE, PAPERWORK_NO, REAL_NAME, DEPT_ID, DEPT_NAME, 
    DEPT_LEVEL, DEPT_TYPE, PARENT_ID, REGIONS_CODE, AVATAR, PASSWORD_PLAIN, 
    DATA_POSITION, CREATOR, CREATE_TIME, UPDATEDBY, UPDATE_TIME, VERSION, IS_DELETED,TYPE
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from USERVIEW
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectUserView" parameterType="com.hcis.ipanther.common.login.vo.LoginUser" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  	WHERE (USER_NAME=#{userName,jdbcType=VARCHAR} or upper(PAPERWORK_NO)=upper(#{userName,jdbcType=VARCHAR}))
  	AND PASSWORD = #{password,jdbcType=VARCHAR}
  </select>
  <select id="selectUserViewById" parameterType="java.lang.String" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  	WHERE ID=#{userId,jdbcType=VARCHAR}
  </select>
  <select id="selectUserViewByPaperworkNo" parameterType="java.lang.String" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  	WHERE PAPERWORK_NO=#{paperworkNo,jdbcType=VARCHAR}
  </select>
  <select id="selectUserViewByAccount" parameterType="java.lang.String" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  	WHERE (USER_NAME=#{account,jdbcType=VARCHAR} or upper(PAPERWORK_NO)=upper(#{account,jdbcType=VARCHAR}))
  </select> 
  <select id="selectUserViewByWechatId" parameterType="java.lang.String" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  	WHERE (WECHAT_ID=#{wechatId,jdbcType=VARCHAR})
  </select> 
  <select id="selectAllLoginUser" resultMap="LoginUser">
  	SELECT * FROM USERVIEW
  </select>
  <select id="selectByDepartCode" resultMap="BaseResultMap" parameterType="searchParam">
  	SELECT   
  	<include refid="Base_Column_List"/>
	FROM USERVIEW t
	where t.id in (select ud.user_id from IPANTHER_USER_DEPT ud 
					where ud.dept_id in (select d.id from ORGANIZATION d 
										where d.is_deleted='N'
    <if test="regionsCode!=null and regionsCode[0]!=''">
											and d.regionsCode=#{regionsCode[0],jdbcType=VARCHAR}
    </if>
    <if test="deptName!=null and deptName[0]!=''">
											and d.org_name like '%#{deptName[0],jdbcType=VARCHAR}%'
    </if>
											)
											and ud.is_deleted='N')
    <if test="userName!=null and userName[0]!=''">
    	AND t.USER_NAME=#{userName[0],jdbcType=VARCHAR}
    </if>
    <if test="realName!=null and realName[0]!=''">
    	AND t.REAL_NAME=#{realName[0],jdbcType=VARCHAR}
    </if>
    <if test="roleCode!=null and roleCode[0]!=''">
    	AND t.ROLE_CODE=#{roleCode[0],jdbcType=DECIMAL}
    </if>
    <if test="paperworkNo!=null and paperworkNo[0]!=''">
    	AND t.PAPERWORK_NO=#{paperworkNo[0],jdbcType=DECIMAL}
    </if>
		and t.is_deleted='N'
		order by t.REAL_NAME
  </select>
  <select id="selectBySearchParam" resultMap="BaseResultMap" parameterType="searchParam" >
    select 
    <include refid="Base_Column_List" />
    from USERVIEW 
    where 1=1
    <if test="userName!=null and userName[0]!=''">
    	AND USER_NAME=#{userName[0],jdbcType=VARCHAR}
    </if>
    <if test="realName!=null and realName[0]!=''">
    	AND REAL_NAME=#{realName[0],jdbcType=VARCHAR}
    </if>
    <if test="roleCode!=null and roleCode[0]!=''">
    	AND ROLE_CODE=#{roleCode[0],jdbcType=DECIMAL}
    </if>
    <if test="deptName!=null and deptName[0]!=''">
    	AND DEPT_NAME like '%${deptName[0]}%'
    </if>
    <if test="paperworkNo!=null and paperworkNo[0]!=''">
    	AND PAPERWORK_NO=#{paperworkNo[0],jdbcType=DECIMAL}
    </if>
     <!--and  data_position ='01' 到时候去掉 -->
     order by REAL_NAME
  </select>
  <select id="checkExistUser" resultMap="BaseResultMap" parameterType="searchParam" >
    select 
    <include refid="Base_Column_List" />
    from USERVIEW 
    where IS_DELETED='N' 
    <if test="id!=null and id[0]!=''">
     	AND ID !=#{id[0],jdbcType=VARCHAR}
    </if>
    <if test="(userName!=null and userName[0]!='') or (paperworkNo!=null and paperworkNo[0]!='')">
    	AND (1!=1 
	    <if test="userName!=null and userName[0]!=''">
	    	OR (USER_NAME=#{userName[0],jdbcType=VARCHAR})
	    </if>
	    <if test="paperworkNo!=null and paperworkNo[0]!=''">
	    	OR (PAPERWORK_NO=#{paperworkNo[0],jdbcType=VARCHAR})
	    </if>
    	)
    </if>
     order by REAL_NAME
  </select> 
</mapper>